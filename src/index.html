<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>Angular</title>
  <base href="/">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/x-icon" href="favicon.ico">
</head>

<body>
  <app-root></app-root>

  <h1>Create Event</h1>

  <div class="grid">
    <div>
      <label for="names">Name:</label>
      <select name="names" id="names">
      </select>
    </div>

    <div>
      <label for="date">Day:</label>
      <input type="date" id="date" name="date">
    </div>

    <div>
      <label for="eventTypes">Event type:</label>
      <select name="eventTypes" id="eventTypes" onchange="handleEventTypeChange()">
        <option value="Conference">Conference</option>
        <option value="Field">Field</option>
        <option value="Out of Office">Out of Office</option>
      </select>
    </div>

    <div>
      <label for="allDay">All day?</label>
      <input type="checkbox" id="allDay" name="allDay" value="allDay" checked onchange="handleAllDayChange()">
    </div>

    <div class="schools" id="locations">
    </div>

    <div id="time" class="time">
      <!-- <label for="startTime">Start time:</label>
      <input type="time" id="startTime" name="startTime" value="12:00"> <br />
      <label for="endTime">End time:</label>
      <input type="time" id="endTime" name="endTime" value="13:00"> -->
    </div>

  </div>


  <button id="authorize_button" onclick="handleAuthClick()">Submit</button>




  <pre id="content" style="white-space: pre-wrap;"></pre>

  <script type="text/javascript">
    /* exported gapiLoaded */
    /* exported gisLoaded */
    /* exported handleAuthClick */
    /* exported handleSignoutClick */

    // TODO(developer): Set to client ID and API key from the Developer Console
    const CLIENT_ID = '867495649327-osufd5ti5dnkjan5ea7krse983r776t3.apps.googleusercontent.com';
    const API_KEY = 'AIzaSyDi7hRaUZ5OdAyVQdwRdxf-EJro2igCp2Q';

    // Discovery doc URL for APIs used by the quickstart
    const DISCOVERY_DOC = 'https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest';

    // Authorization scopes required by the API; multiple scopes can be
    // included, separated by spaces.
    const SCOPES = 'https://www.googleapis.com/auth/calendar';

    let tokenClient;
    let gapiInited = false;
    let gisInited = false;

    document.getElementById('authorize_button').style.visibility = 'hidden';

    /**
     * Callback after api.js is loaded.
     */
    function gapiLoaded() {
      gapi.load('client', initializeGapiClient);
    }

    /**
     * Callback after the API client is loaded. Loads the
     * discovery doc to initialize the API.
     */
    async function initializeGapiClient() {
      await gapi.client.init({
        apiKey: API_KEY,
        discoveryDocs: [DISCOVERY_DOC],
      });
      gapiInited = true;
      maybeEnableButtons();
    }

    /**
     * Callback after Google Identity Services are loaded.
     */
    function gisLoaded() {
      tokenClient = google.accounts.oauth2.initTokenClient({
        client_id: CLIENT_ID,
        scope: SCOPES,
        callback: '', // defined later
      });
      gisInited = true;
      maybeEnableButtons();
    }

    /**
     * Enables user interaction after all libraries are loaded.
     */
    function maybeEnableButtons() {
      if (gapiInited && gisInited) {
        document.getElementById('authorize_button').style.visibility = 'visible';
      }
    }

    /**
     *  Sign in the user upon button click.
     */
    function handleAuthClick() {
      tokenClient.callback = async (resp) => {
        if (resp.error !== undefined) {
          throw (resp);
        }
        addEvent();
      };

      if (gapi.client.getToken() === null) {
        // Prompt the user to select a Google Account and ask for consent to share their data
        // when establishing a new session.
        tokenClient.requestAccessToken({ prompt: 'consent' });
      } else {
        // Skip display of account chooser and consent dialog for an existing session.
        tokenClient.requestAccessToken({ prompt: '' });
      }
    }

    /**
     *  Sign out the user upon button click.
     */
    function handleSignoutClick() {
      const token = gapi.client.getToken();
      if (token !== null) {
        google.accounts.oauth2.revoke(token.access_token);
        gapi.client.setToken('');
        document.getElementById('content').innerText = '';
        document.getElementById('authorize_button').innerText = 'Authorize';
        document.getElementById('signout_button').style.visibility = 'hidden';
      }
    }

    /**
     * Print the summary and start datetime/date of the next ten events in
     * the authorized user's calendar. If no events are found an
     * appropriate message is printed.
     */


    function addEvent() {
      let dateLength = document.getElementById('date').value.length;
      if (dateLength == 0) {
        alert('ERROR: Please select a date.');
        return;
      }
      let locations = getLocations();
      let summaryString = document.getElementById('names').value + ' - ' + document.getElementById('eventTypes').value + (document.getElementById('eventTypes').value == "Field" && locations.length > 0 ? ' (' + locations + ')' : '');
      const event = {
        summary: summaryString,
        description: '',
        start: {
          dateTime: document.getElementById('allDay').checked ? null : document.getElementById('date').value + 'T' + document.getElementById('startTime').value + ':00-04:00',
          date: document.getElementById('allDay').checked ? document.getElementById('date').value : null
        },
        end: {
          dateTime: document.getElementById('allDay').checked == true ? null : document.getElementById('date').value + 'T' + document.getElementById('endTime').value + ':00-04:00',
          date: document.getElementById('allDay').checked == true ? document.getElementById('date').value : null
        },
        colorId: document.getElementById('eventTypes').value == "Field" ? "10" : document.getElementById('eventTypes').value == "Conference" ? "5" : "0",
        attendees: [],
        reminders: {
        },
      };

      const request = gapi.client.calendar.events.insert({
        calendarId: 'c_f049b179cd81305d0df146197f30755153a65542312c9c86ad719559138b61c6@group.calendar.google.com',
        resource: event,
      });

      request.execute(function (event) {
        console.log('Event created: ' + event.htmlLink);
      });
    }

    function handleEventTypeChange() {
      const eventType = document.getElementById('eventTypes').value;
      const locationsDiv = document.getElementById('locations');

      // Clear any existing content in the locations div
      locationsDiv.innerHTML = '';

      if (eventType === "Field") {
        // Generate location checkboxes dynamically
        locations.forEach(location => {
          const label = document.createElement('label');
          const checkbox = document.createElement('input');
          checkbox.type = 'checkbox';
          checkbox.name = location;
          checkbox.id = location;
          checkbox.value = location;
          label.appendChild(checkbox);
          label.appendChild(document.createTextNode(` ${location}`));
          locationsDiv.appendChild(label);
        });
      }
    }

    function handleAllDayChange() {
      const allDay = document.getElementById('allDay').checked;
      const timeDiv = document.getElementById('time');

      // Clear the time div
      timeDiv.innerHTML = '';

      if (!allDay) {
        // Dynamically create and append the start time input
        const startTimeLabel = document.createElement('label');
        startTimeLabel.setAttribute('for', 'startTime');
        startTimeLabel.textContent = 'Start time:';
        timeDiv.appendChild(startTimeLabel);

        const startTimeInput = document.createElement('input');
        startTimeInput.type = 'time';
        startTimeInput.id = 'startTime';
        startTimeInput.name = 'startTime';
        startTimeInput.value = '12:00';
        timeDiv.appendChild(startTimeInput);

        // Add a line break
        timeDiv.appendChild(document.createElement('br'));

        // Dynamically create and append the end time input
        const endTimeLabel = document.createElement('label');
        endTimeLabel.setAttribute('for', 'endTime');
        endTimeLabel.textContent = 'End time:';
        timeDiv.appendChild(endTimeLabel);

        const endTimeInput = document.createElement('input');
        endTimeInput.type = 'time';
        endTimeInput.id = 'endTime';
        endTimeInput.name = 'endTime';
        endTimeInput.value = '13:00';
        timeDiv.appendChild(endTimeInput);
      }
    }

    function getLocations() {
      const checkboxes = document.querySelectorAll('input[type="checkbox"]:checked');
      const selectedLocations = Array.from(checkboxes)
        .filter(checkbox => checkbox.id !== 'allDay') // Exclude the allDay checkbox
        .map(checkbox => checkbox.value);
      return selectedLocations.join(', ');
    }
  </script>
  <script>
    const names = [
      "Aaron McQuade", "Alex Fudge", "Andrew Dunlop", "Andrew Lebert", "Andrew Smith",
      "Anthony Walsh", "Bethany McCulloch", "Brad Pilon", "Corey Graveline-Dumouchel",
      "David Priebe", "Dean Cybulski", "Don White", "Gavin McGinley", "Josh Burton",
      "Justin Lepine", "Kathy Prescott", "Matt Beres", "Michelle Rowe", "Mitch Yackobeck",
      "Sheri Larochelle", "Terri Lee", "Trevor Smith"
    ];

    const locations = [
      "ADH", "ADM", "AJC", "BCH", "CEN", "CDS", "COB", "EGN", "FHS", "HRM",
      "HVW", "KIL", "MCS", "MCN", "MHS", "MVD", "OHS", "PAL", "PVW", "QEL",
      "RCA", "RCI", "RCIS", "RCK", "VAL", "WPS", "WZD"
    ];

    function generateDynamicContent() {
      // Generate names dropdown options
      const namesSelect = document.getElementById('names');
      names.forEach(name => {
        const option = document.createElement('option');
        option.value = name;
        option.textContent = name;
        namesSelect.appendChild(option);
      });
    }

    // Call the function after the DOM is fully loaded
    document.addEventListener('DOMContentLoaded', generateDynamicContent);
  </script>
  <script async defer src="https://apis.google.com/js/api.js" onload="gapiLoaded()"></script>
  <script async defer src="https://accounts.google.com/gsi/client" onload="gisLoaded()"></script>
</body>

</html>